const items = {
    main:[
        ['body','Body parts','src/img/body/body0.png'],
        ['cloth','Clothing','src/img/cloth/cloth0.png'],
        ['food','Food','src/img/food/food0.png'],
        ['sea','Sea animal','src/img/sea/sea0.png'],
        ['color','Color','src/img/color/color0.png'],
        ['figure','Figures','src/img/figure/figure0.png'],
        ['fruit','Fruits','src/img/fruit/fruit0.png'],
        ['transport','Transport','src/img/transport/trnsport0.png']
    ],
    body:[
        // ['src/img/body/body0.png','Body parts','','Тело'],
        ['src/img/body/body1.png','Arm','src/audio/body/body1.mp3','Рука'],
        ['src/img/body/body2.png','Cheek','src/audio/body/body2.mp3','Щека'],
        ['src/img/body/body3.png','Chin','src/audio/body/body3.mp3','Подбородок'],
        ['src/img/body/body4.png','Leg','src/audio/body/body4.mp3','Нога'],
        ['src/img/body/body5.png','Lips','src/audio/body/body5.mp3','Губы'],
        ['src/img/body/body6.png','Neck','src/audio/body/body6.mp3','Шея'],
        ['src/img/body/body7.png','Hand','src/audio/body/body7.mp3','Ладонь'],
        ['src/img/body/body8.png','Eyes','src/audio/body/body8.mp3','Глаза']],
    cloth:[
        // ['src/img/cloth/cloth0.png','Body parts','','Тело'],
        ['src/img/cloth/cloth1.png','Belt','src/audio/cloth/cloth1.mp3','Ремень'],
        ['src/img/cloth/cloth2.png','Boots','src/audio/cloth/cloth2.mp3','Ботинки'],
        ['src/img/cloth/cloth3.png','Gloves','src/audio/cloth/cloth3.mp3','Перчатки'],
        ['src/img/cloth/cloth4.png','Hat','src/audio/cloth/cloth4.mp3','Шляпа'],
        ['src/img/cloth/cloth5.png','Shoes','src/audio/cloth/cloth5.mp3','Обувь'],
        ['src/img/cloth/cloth6.png','Socks','src/audio/cloth/cloth6.mp3','Носки'],
        ['src/img/cloth/cloth7.png','Skirt','src/audio/cloth/cloth7.mp3','Юбка'],
        ['src/img/cloth/cloth8.png','Mittens','src/audio/cloth/cloth8.mp3','Рукавицы']],
    food:[
        // ['src/img/food/food0.png','Body parts','','Тело'],
        ['src/img/food/food1.png','Apple','src/audio/food/food1.mp3','Яблоко'],
        ['src/img/food/food2.png','Cheese','src/audio/food/food2.mp3','Сыр'],
        ['src/img/food/food3.png','Cookie','src/audio/food/food3.mp3','Печенье'],
        ['src/img/food/food4.png','Mushroom','src/audio/food/food4.mp3','Гриб'],
        ['src/img/food/food5.png','Hamburger','src/audio/food/food5.mp3','Гамбургер'],
        ['src/img/food/food6.png','Sandvich','src/audio/food/food6.mp3','Бутерброд'],
        ['src/img/food/food7.png','Tomato','src/audio/food/food7.mp3','Помидор'],
        ['src/img/food/food8.png','Soup','src/audio/food/food8.mp3','Суп']],
    sea:[
        ['src/img/sea/sea1.png','Crab','src/audio/sea/sea1.mp3','Краб'],
        ['src/img/sea/sea2.png','Fish','src/audio/sea/sea2.mp3','Рыбка'],
        ['src/img/sea/sea3.png','Sea horse','src/audio/sea/sea3.mp3','Морской конек'],
        ['src/img/sea/sea4.png','Starfish','src/audio/sea/sea4.mp3','Морская звезда'],
        ['src/img/sea/sea5.png','Jellyfish','src/audio/sea/sea5.mp3','Медуза'],
        ['src/img/sea/sea6.png','Oyster','src/audio/sea/sea6.mp3','Устрица'],
        ['src/img/sea/sea7.png','Shark','src/audio/sea/sea7.mp3','Акула'],
        ['src/img/sea/sea8.png','Squid','src/audio/sea/sea8.mp3','Кальмар']],
    color:[
        ['src/img/color/color1.png','Black','src/audio/color/color1.mp3','Черный'],
        ['src/img/color/color2.png','Blue','src/audio/color/color2.mp3','Синий'],
        ['src/img/color/color3.png','Brown','src/audio/color/color3.mp3','Коричневый'],
        ['src/img/color/color4.png','Gray','src/audio/color/color4.mp3','Серый'],
        ['src/img/color/color5.png','Green','src/audio/color/color5.mp3','Зеленый'],
        ['src/img/color/color6.png','Orange','src/audio/color/color6.mp3','Оранжевый'],
        ['src/img/color/color7.png','Pink','src/audio/color/color7.mp3','Розовый'],
        ['src/img/color/color8.png','Purple','src/audio/color/color8.mp3','Фиолетовый']],
    figure:[
        ['src/img/figure/figure1.png','Circle','src/audio/figure/figure1.mp3','Круг'],
        ['src/img/figure/figure2.png','Cone','src/audio/figure/figure2.mp3','Конус'],
        ['src/img/figure/figure3.png','Cylinder','src/audio/figure/figure3.mp3','Цылиндр'],
        ['src/img/figure/figure4.png','Pentagon','src/audio/figure/figure4.mp3','Пятиугольник'],
        ['src/img/figure/figure5.png','Parallelogram','src/audio/figure/figure5.mp3','Паралеллограм'],
        ['src/img/figure/figure6.png','Sphere','src/audio/figure/figure6.mp3','Сфера'],
        ['src/img/figure/figure7.png','Square','src/audio/figure/figure7.mp3','Квадрат'],
        ['src/img/figure/figure8.png','Star','src/audio/figure/figure8.mp3','Звезда']],
    fruit:[
        ['src/img/fruit/fruit1.png','Blackberries','src/audio/fruit/fruit1.mp3','Еживика'],
        ['src/img/fruit/fruit2.png','Blueberries','src/audio/fruit/fruit2.mp3','Черника'],
        ['src/img/fruit/fruit3.png','Cherry','src/audio/fruit/fruit3.mp3','Черешня'],
        ['src/img/fruit/fruit4.png','Plum','src/audio/fruit/fruit4.mp3','Слива'],
        ['src/img/fruit/fruit5.png','Strawberry','src/audio/fruit/fruit5.mp3','Клубника'],
        ['src/img/fruit/fruit6.png','Grapes','src/audio/fruit/fruit6.mp3','Виноград'],
        ['src/img/fruit/fruit7.png','Grapefruit','src/audio/fruit/fruit7.mp3','Грейпфрут'],
        ['src/img/fruit/fruit8.png','Lime','src/audio/fruit/fruit8.mp3','Лайм']],
    transport:[
        ['src/img/transport/transport1.png','Airplane','src/audio/transport/transport1.mp3','Самолет'],
        ['src/img/transport/transport2.png','Bicycle','src/audio/transport/transport2.mp3','Велосипед'],
        ['src/img/transport/transport3.png','Motorcycle','src/audio/transport/transport3.mp3','Мотоцыкл'],
        ['src/img/transport/transport4.png','Taxi','src/audio/transport/transport4.mp3','Такси'],
        ['src/img/transport/transport5.png','Submarine','src/audio/transport/transport5.mp3','Подводная лодка'],
        ['src/img/transport/transport6.png','Scooter','src/audio/transport/transport6.mp3','Мопед'],
        ['src/img/transport/transport7.png','Rocket','src/audio/transport/transport7.mp3','Ракета'],
        ['src/img/transport/transport8.png','Car','src/audio/transport/transport8.mp3','Машина']],
}

// let statistic = [
//     ['Arm','Рука',0,0,0],
//     ['Cheek','Щека',0,0,0],
//     ['Chin','Подбородок',0,0,0],
//     ['Leg','Нога',0,0,0],
//     ['Lips','Губы',0,0,0],
//     ['Neck','Шея',0,0,0],
//     ['Hand','Ладонь',0,0,0],
//     ['Eyes','Глаза',0,0,0],
//     ['Belt','Ремень',0,0,0],
//     ['Boots','Ботинки',0,0,0],
//     ['Gloves','Перчатки',0,0,0],
//     ['Hat','Шляпа',0,0,0],
//     ['Shoes','Обувь',0,0,0],
//     ['Socks','Носки',0,0,0],
//     ['Skirt','Юбка',0,0,0],
//     ['Mittens','Рукавицы',0,0,0],
//     ['src/img/food/food1.png','Apple','src/audio/food/food1.mp3','Яблоко'],
//     ['src/img/food/food2.png','Cheese','src/audio/food/food2.mp3','Сыр'],
//     ['src/img/food/food3.png','Cookie','src/audio/food/food3.mp3','Печенье'],
//     ['src/img/food/food4.png','Mushroom','src/audio/food/food4.mp3','Гриб'],
//     ['src/img/food/food5.png','Hamburger','src/audio/food/food5.mp3','Гамбургер'],
//     ['src/img/food/food6.png','Sandvich','src/audio/food/food6.mp3','Бутерброд'],
//     ['src/img/food/food7.png','Tomato','src/audio/food/food7.mp3','Помидор'],
//     ['src/img/food/food8.png','Soup','src/audio/food/food8.mp3','Суп']
// ]




let arr = [];
const cards = document.querySelector('.cards');
const card = document.querySelectorAll('.card');
const cardInfo = document.querySelectorAll('.card .info');
const menu = document.querySelector('.menu-togle');
const nav = document.querySelector('nav');
const span = document.querySelectorAll('.menu-togle span');
const switchEl = document.querySelector('.switch');
const train = document.querySelector('.train')
const play = document.querySelector('.play')
const check = document.querySelector('.check')
const playStart = document.querySelector('.playStart')
const result = document.querySelector('.result')
const statLi = document.querySelector('.statistic')
let winCount = 0;
let loseCount = 0;
let playArr = [];



let statistic = [];

for(let key in items){
    statistic.push(items[key])
}
statistic.shift()
let words = []

for(let key1 of statistic){
    for(let key2 of key1){
        words.push(key2.filter((el,i)=>i==1 || i == 3));
    }
}

for(let key of words){
    key.push(0);
    key.push(0);
    key.push(0);
    key.push(0);
}

const stat = document.querySelector('.stat')


if(localStorage.getItem("eng") == null){
    localStorage.setItem('eng', '[]')
} else {
    words = JSON.parse(localStorage.getItem("eng"))
}


let serialArr = JSON.stringify(words);
localStorage.setItem('eng', serialArr);


const tableRender = () =>{
    cards.style.display = 'none'
    statLi.style.display = 'block'
    let serialArr = JSON.stringify(words);
    localStorage.setItem('eng', serialArr);
    stat.innerHTML = ''
    words.forEach(el=>{
        el.forEach(el =>{
            div = document.createElement('div')
            div.className = 'word'
            div.innerHTML = el
            stat.append(div)
        })
    })
}




let aud = 0;
menu.addEventListener('click', (e)=>{
        if(e.target.classList.contains('tog')){
            e.target.closest('div').classList.remove('tog')
            span.forEach(el=>el.classList.remove('tog'))
            nav.style.left = -300 +'px'
            span[1].style.display = 'block'
            span[0].style.transform = 'rotate(0deg)'
            span[2].style.transform = 'rotate(0deg)'
            span[0].style.top = '0'
        } else {
            e.target.closest('div').classList.add('tog')
            span.forEach(el=>el.classList.add('tog'))
            nav.style.left = 0
            span[1].style.display = 'none'
            span[0].style.transform = 'rotate(45deg)'
            span[2].style.transform = 'rotate(-45deg)'
            span[0].style.top = '11px'
        } 
})

document.body.addEventListener('click', (e)=>{
    let navi = e.target.closest('nav');
    let menus = e.target.closest('div').classList.contains('menu-togle')
    if(!navi && !menus){
        menu.classList.remove('tog');
        span.forEach(el=>el.classList.remove('tog'));
        nav.style.left = -300 +'px';
        span[0].style.transform = 'rotate(0deg)' ;
        span[0].style.top = '0';
        span[1].style.display = 'block';
        span[2].style.transform = 'rotate(0deg)';
    }
})

nav.addEventListener('click', (e)=>{
    let li = e.target.closest('li');
    let listat = e.target.classList.contains('listat');
    if(listat){
        tableRender()
        menu.classList.remove('tog');
        span.forEach(el=>el.classList.remove('tog'));
        nav.style.left = -300 +'px';
        span[0].style.transform = 'rotate(0deg)' ;
        span[0].style.top = '0';
        span[1].style.display = 'block';
        span[2].style.transform = 'rotate(0deg)';
        card.forEach(el=>el.style = '');
        result.innerHTML = '';
        playStart.classList.remove('repeat');
        playStart.innerHTML = 'START GAME';
        winCount = 0;
        loseCount = 0;
        isPlay = false
    }
    if(li && !listat) {
        cards.style.display = 'flex'
        statLi.style.display = 'none'
        let info = e.target.closest('li').classList[0];
        cardTopic(info);
        menu.classList.remove('tog');
        span.forEach(el=>el.classList.remove('tog'));
        nav.style.left = -300 +'px';
        span[0].style.transform = 'rotate(0deg)' ;
        span[0].style.top = '0';
        span[1].style.display = 'block';
        span[2].style.transform = 'rotate(0deg)';
        card.forEach(el=>el.style = '');
        result.innerHTML = '';
        playStart.classList.remove('repeat');
        playStart.innerHTML = 'START GAME';
        winCount = 0;
        loseCount = 0;
        isPlay = false
    } 
})


cards.addEventListener('click', (e)=>{
    let div = e.target.closest('div').classList.contains('card');
    let divT = e.target.closest('div').classList.contains('trans');
    if(div && !divT) {
        let info = e.target.closest('div').classList[1]
        cardTopic(info)
    } 
})

card.forEach((el,i)=>{
    el.querySelector('.rotate').addEventListener('click', ()=>rotateRu(i));
}); 

function cardTopic(info){
    if(info == 'main'){
        card.forEach(el=>el.style = '');
        result.innerHTML = '';
        playStart.classList.remove('repeat');
        playStart.innerHTML = 'START GAME';
        card.forEach((el,i)=>{
            el.className = 'card ' + items.main[i][0] + ' off'
            el.querySelector('p').innerText = items.main[i][1]
            el.querySelector('img').src = items.main[i][2]
            el.querySelector('.rotate').style.display = 'none'
            cards.classList.add('off')
            cards.querySelectorAll('.card p').forEach(el => el.style.display = 'block')
            cards.querySelectorAll('.card img').forEach(el => {el.style.marginTop = '20px'})
            playStart.style.display = 'none'
        })
    } else {
    cards.classList.remove('off')
    aud = 0
    card.forEach((el,i)=>{
        if(items[info]) {
            arr = items[info];
        }
        el.className = `card ${info}`
        el.querySelector('img').src = arr[i][0]
        el.querySelector('p').innerText = arr[i][1]
        if(check.checked){
            el.querySelectorAll('.card p').forEach(el => el.style.display = 'none')
            el.querySelectorAll('.card .rotate').forEach(el => el.style.display = 'none')
            el.querySelector('.rotate').style.display = 'none'
            cards.classList.add('playCard')
            cards.querySelectorAll('.card img').forEach(el => el.style.marginTop = 0)
            playStart.style.display = 'flex'
        }
        if(cards.classList.contains('playCard')){
            el.querySelector('.rotate').style.display = 'none'
        } else {
            el.querySelector('.rotate').style.display = 'block'
        }
        el.addEventListener('click',(e)=>{
            if(cards.closest('div').classList.contains('playCard')){return}
            if(e.target.closest('div').classList.contains('rotate')){return}
            if(e.target.closest('div').classList.contains('off')){return}
            if(aud == 0){
                let audio = new Audio(arr[i][2]);
                audio.play();
                aud++
            }
            
        })
    })
}
}

function rotateRu(i){
    card[i].classList.add('trans')
    card[i].style.transform = 'rotateY(180deg)'
    card[i].querySelector('p').style.transform = 'rotateY(180deg)'
    card[i].querySelector('p').innerHTML = arr[i][3]
    card[i].querySelector('img').style.transform = 'rotateY(180deg)'
    card[i].querySelector('.rotate').style.display = 'none'
    cards.classList.remove('off')
        cards.onmouseover = ((e)=>{
            let div = e.target.classList.contains('cards');
            let off = cards.classList.contains('off')
            if(div && !off){
                rotateEng(i)
            }
        })
}

function rotateEng(i){
    if(!check.checked){
        card[i].classList.remove('trans')
        card[i].style = ''
        card[i].querySelector('p').style = ''
        card[i].querySelector('p').innerHTML = arr[i][1]
        card[i].querySelector('img').style = ''
        card[i].querySelector('.rotate').style.display = 'block'
        cards.removeEventListener('mouseover', rotateEng , false)
    }
}


switchEl.addEventListener('click',(e)=>{
    if(e.target.closest('input')){
        if(e.target.checked){
            if(cards.classList.contains('off')){
                train.style.opacity = 0
                play.style.opacity = 100
                cards.querySelectorAll('.card p').forEach(el => el.style.textShadow = '0px 0px 5px #e73827')
                cards.querySelectorAll('.card img').forEach(el => el.style.border = '5px solid #e73827')
            } else {
                train.style.opacity = 0
                play.style.opacity = 100
                cards.querySelectorAll('.card p').forEach(el => el.style.display = 'none')
                cards.querySelectorAll('.card .rotate').forEach(el => el.style.display = 'none')
                cards.querySelectorAll('.card img').forEach(el => el.style.marginTop = 0)
                cards.classList.add('playCard')
                cards.querySelectorAll('.card img').forEach(el => el.style.border = '5px solid #e73827')
                playStart.style.display = 'flex'
            }
        } else {
            train.style.opacity = 100
            play.style.opacity = 0
            cards.querySelectorAll('.card p').forEach(el => el.style.display = 'block')
            cards.querySelectorAll('.card img').forEach(el => el.style.marginTop = '20px')
            cards.classList.remove('playCard')
            cards.querySelectorAll('.card p').forEach(el => el.style.textShadow = '0px 0px 5px black')
            cards.querySelectorAll('.card img').forEach(el => el.style.border = 'solid 5px #ccc')
            playStart.style.display = 'none'
            card.forEach(el=>{
                el.style = ''
            })
            isPlay = false
            result.innerHTML = ''
            playStart.classList.remove('repeat')
            playStart.innerHTML = 'START GAME'
            winCount = 0;
            loseCount = 0;
            playArr = [];
            if(cards.classList.contains('off')){
                cards.querySelectorAll('.card .rotate').forEach(el => el.style.display = 'none')
            } else {
                cards.querySelectorAll('.card .rotate').forEach(el => el.style.display = 'block')
            }
        }
    }
})




let audio

let isPlay = false;


const clickStart = (e)=>{
    // card.forEach(el=>{
    //     el.style = ''
    // })
    // result.innerHTML = ''
    audioFalse = true
    
    playStart.classList.add('repeat')
    playStart.innerHTML = ''

    let repeat = document.body.querySelector('.playStart').classList.contains('repeat')

    if(repeat && isPlay){
        audio = new Audio(playArr[0][1])
        audio.play();
    } else {
        playArr = []
        let info = card[0].classList[1]
        
        card.forEach((el,i)=>{
            info = el.classList[1]
            for(let key in items){
                if(info == key){
                    playArr.push([items[key][i][1],items[key][i][2]])
                }
            }
        })
        playArr.sort(function(){
            return Math.random() - 0.5;
        })
    }
    startGame(playArr)
}

playStart.onclick = clickStart


let win
let winWord
let audioFalse = true


const startGame = (playArr)=>{
    isPlay = true
    if(audioFalse){
        audio = new Audio(playArr[0][1]);
        audioFalse = false
    }
    win = playArr[0][0]
    audio.play();
    document.body.onclick = ((e)=>{
        let div;
        if(e.target.closest('div')) {
            div = e.target.closest('div').classList.contains('card');
        }
        let repeat = document.body.querySelector('.playStart').classList.contains('repeat')
        if(!repeat){return}
        else if(div && check.checked){
            winWord = e.target.closest('div').querySelector('p').innerText
            winWord == win ? winner(e,winWord) : lose(winWord)
        }
    })
}


const winner = (e,winWord) => {
    winStat(winWord)
    audioFalse = true
    win = null
    playArr.shift()
    let star = document.createElement('img')
    star.src = 'src/img/win.svg'
    result.append(star)
    audio = new Audio('src/audio/correct.mp3');
    audio.play();  
    e.target.closest('div').style.pointerEvents = 'none'
    e.target.closest('div').style.background = 'rgba(0,0,0,0.35)'
    winCount ++ 
    console.log(winCount)
    playArr.length == 0 ? endGame() : startGame(playArr)  
}

const lose = (winWord) => {
    loseStat(winWord)
    let star = document.createElement('img')
    star.src = 'src/img/lose.svg'
    result.append(star)
    audio = new Audio('src/audio/error.mp3');
    audio.play();  
    loseCount ++
    console.log(loseCount)
    startGame(playArr)                
}


const all = document.querySelector('.all')
const grac = document.querySelector('.grac')
const noGrac = document.querySelector('.no-grac')

const endGame = ()=>{
    if(loseCount>0){
        audio = new Audio('src/audio/failure.mp3');
        audio.play(); 
        all.style.display = 'none'
        noGrac.style.display = 'flex'
        noGrac.innerHTML = `<p>${loseCount} errors</p>`
        setTimeout(() => allIn(), 3000)
    } else {
        audio = new Audio('src/audio/success.mp3');
        audio.play(); 
        all.style.display = 'none'
        grac.style.display = 'flex'
        setTimeout(() => allIn(), 3000)
    }
}

const allIn = () => {
    isPlay = false
    winCount = 0;
    loseCount = 0;
    all.style.display = 'flex'
    noGrac.style.display = 'none'
    grac.style.display = 'none'
    cardTopic('main')
}

const loseStat = (winWord) => {
    words.forEach((el,i)=>{
        el.forEach(el=>{
            if(el == winWord){
                words[i][4]++
                words[i][5] = ((words[i][4] * 100)/(words[i][3]+words[i][4]))
            }
        })
    })
}

const winStat = (winWord) => {
    words.forEach((el,i)=>{
        el.forEach(el=>{
            if(el == winWord){
                words[i][3]++
                words[i][5] = ((words[i][4] * 100)/(words[i][3]+words[i][4]))
            }
        })
    })
}